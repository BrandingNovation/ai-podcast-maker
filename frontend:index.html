<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Podcast Maker | Multi-Character Voices</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* All the CSS from the previous implementation */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #0a0a0a;
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }
        
        /* ... (all the CSS styles from earlier) ... */
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-podcast logo-icon"></i>
                <h1>AI Podcast Maker</h1>
            </div>
            <div class="ai-badge">Powered by Gemini 2.5</div>
        </header>
        
        <div class="main-content">
            <!-- Left Panel - Script Editor & Character Management -->
            <div class="panel">
                <div class="panel-title">
                    <i class="fas fa-edit"></i>
                    Script Editor
                </div>
                
                <textarea class="script-editor" id="script-editor" placeholder="Enter your podcast script here... Add character markers like [CHARACTER:Name] before dialogue.">[HOST]
Welcome to AI Fashion Insights, the podcast where we explore the intersection of artificial intelligence and fashion design.

[EXPERT]
In today's episode, we'll discuss how AI is revolutionizing the way designers create and visualize their collections.

[HOST]
That's right! With tools like Gemini AI, designers can now generate realistic fashion compositions in minutes.

[TECH]
The neural networks behind these systems are trained on millions of fashion images, allowing them to understand style, texture, and composition at a deeply intuitive level.</textarea>
                
                <div class="panel-title">
                    <i class="fas fa-users"></i>
                    Character Management
                </div>
                
                <div class="character-management">
                    <div class="characters-list" id="characters-list">
                        <!-- Characters will be added here dynamically -->
                    </div>
                    
                    <button class="add-character-btn" id="add-character-btn">
                        <i class="fas fa-plus"></i>
                        Add Character
                    </button>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-generate" id="generate-btn">
                        <i class="fas fa-magic"></i>
                        Generate Podcast
                    </button>
                    <button class="btn btn-download" id="download-btn" disabled>
                        <i class="fas fa-download"></i>
                        Download
                    </button>
                </div>
                
                <div class="backend-status">
                    <div class="status-indicator"></div>
                    <div class="status-text">Connected to n8n backend</div>
                </div>
                
                <div class="loading" id="loading-indicator">
                    <div class="spinner"></div>
                    <p>Generating your podcast... This may take a minute.</p>
                </div>
                
                <div class="n8n-info">
                    <h3><i class="fas fa-info-circle"></i> n8n Integration</h3>
                    <p>This app is powered by n8n workflows running on your backend. All podcast generation is handled automatically through your configured n8n automation.</p>
                </div>
            </div>
            
            <!-- Right Panel - Audio Preview & Voice Settings -->
            <div class="panel">
                <div class="panel-title">
                    <i class="fas fa-play-circle"></i>
                    Audio Preview
                </div>
                
                <div class="audio-container">
                    <div class="waveform" id="waveform">
                        <div class="wave-bars" id="wave-bars">
                            <!-- Waveform bars will be generated by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="current-speaker" id="current-speaker">
                        Now speaking: <span id="speaker-name">HOST</span>
                    </div>
                    
                    <div class="audio-controls">
                        <button class="audio-btn" id="play-btn" disabled>
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="audio-btn" id="pause-btn" disabled>
                            <i class="fas fa-pause"></i>
                        </button>
                        <button class="audio-btn" id="stop-btn" disabled>
                            <i class="fas fa-stop"></i>
                        </button>
                    </div>
                    
                    <div class="control-label">
                        <span>Progress</span>
                        <span id="time-display">0:00 / 0:00</span>
                    </div>
                    <div class="slider-container">
                        <input type="range" min="0" max="100" value="0" class="slider" id="progress-slider" disabled>
                    </div>
                    
                    <div class="control-label" style="margin-top: 20px;">
                        <span>Volume</span>
                        <span class="value-display" id="volume-value">70%</span>
                    </div>
                    <div class="slider-container">
                        <input type="range" min="0" max="100" value="70" class="slider" id="volume-slider">
                    </div>
                </div>
                
                <div class="panel-title">
                    <i class="fas fa-music"></i>
                    Background Music
                </div>
                
                <div class="control-group">
                    <div class="control-label">
                        <span>Music Style</span>
                    </div>
                    <select id="music-style">
                        <option value="none">No Background Music</option>
                        <option value="ambient">Ambient</option>
                        <option value="upbeat">Upbeat</option>
                        <option value="corporate">Corporate</option>
                        <option value="cinematic">Cinematic</option>
                        <option value="electronic">Electronic</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <div class="control-label">
                        <span>Music Volume</span>
                        <span class="value-display" id="music-volume-value">30%</span>
                    </div>
                    <div class="slider-container">
                        <input type="range" min="0" max="100" value="30" class="slider" id="music-volume-slider">
                    </div>
                </div>
                
                <div class="voice-examples">
                    <div class="panel-title">
                        <i class="fas fa-lightbulb"></i>
                        Voice Examples
                    </div>
                    
                    <div class="example-item" data-desc="A heavy Mexican Chino accent that's computer savvy and street smart">
                        <div class="example-title">Tech-Savvy Urban</div>
                        <div class="example-desc">Mexican-Chino accent, street smart, tech fluent</div>
                    </div>
                    
                    <div class="example-item" data-desc="A sophisticated British accent with academic undertones">
                        <div class="example-title">Academic Expert</div>
                        <div class="example-desc">British accent, academic, sophisticated</div>
                    </div>
                    
                    <div class="example-item" data-desc="A warm, friendly American Midwest accent that's welcoming and approachable">
                        <div class="example-title">Friendly Host</div>
                        <div class="example-desc">Midwest American, warm, approachable</div>
                    </div>
                    
                    <div class="example-item" data-desc="A smooth, deep voice with a slight rasp and urban flair">
                        <div class="example-title">Urban Storyteller</div>
                        <div class="example-desc">Deep voice, slight rasp, urban flair</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Character Modal -->
    <div class="character-modal" id="character-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Add New Character</h3>
                <button class="close-modal" id="close-modal">&times;</button>
            </div>
            
            <div class="form-group">
                <label class="form-label">Character Name</label>
                <input type="text" class="form-input" id="character-name" placeholder="e.g., Tech Expert, Host, Narrator">
            </div>
            
            <div class="form-group">
                <label class="form-label">Voice Description</label>
                <textarea class="form-textarea" id="voice-description" placeholder="Describe the voice personality, accent, and tone. Example: 'A heavy Mexican Chino accent that's computer savvy and street smart'"></textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label">Voice Tags</label>
                <div class="tags-container" id="tags-container">
                    <!-- Tags will be added here -->
                </div>
                <div class="tag-input">
                    <input type="text" id="tag-input" placeholder="Add a tag (e.g., mexican, tech, deep-voice)">
                    <button id="add-tag-btn">Add</button>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancel-btn">Cancel</button>
                <button class="btn btn-primary" id="save-character-btn">Save Character</button>
            </div>
        </div>
    </div>

    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notification-text">Podcast generated successfully!</span>
    </div>

    <script>
        // All the JavaScript from the previous implementation
        document.addEventListener('DOMContentLoaded', function() {
            // Character management
            const characters = [];
            let currentCharacterId = null;
            const charactersList = document.getElementById('characters-list');
            const addCharacterBtn = document.getElementById('add-character-btn');
            const characterModal = document.getElementById('character-modal');
            const closeModal = document.getElementById('close-modal');
            const cancelBtn = document.getElementById('cancel-btn');
            const saveCharacterBtn = document.getElementById('save-character-btn');
            const modalTitle = document.getElementById('modal-title');
            const characterNameInput = document.getElementById('character-name');
            const voiceDescriptionInput = document.getElementById('voice-description');
            const tagsContainer = document.getElementById('tags-container');
            const tagInput = document.getElementById('tag-input');
            const addTagBtn = document.getElementById('add-tag-btn');
            const scriptEditor = document.getElementById('script-editor');
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notification-text');
            
            // Audio elements
            const playBtn = document.getElementById('play-btn');
            const pauseBtn = document.getElementById('pause-btn');
            const stopBtn = document.getElementById('stop-btn');
            const progressSlider = document.getElementById('progress-slider');
            const timeDisplay = document.getElementById('time-display');
            const volumeSlider = document.getElementById('volume-slider');
            const volumeValue = document.getElementById('volume-value');
            const musicVolumeSlider = document.getElementById('music-volume-slider');
            const musicVolumeValue = document.getElementById('music-volume-value');
            const waveBars = document.getElementById('wave-bars');
            const currentSpeaker = document.getElementById('current-speaker');
            const speakerName = document.getElementById('speaker-name');
            const downloadBtn = document.getElementById('download-btn');
            
            // Audio state
            let isPlaying = false;
            let progressInterval;
            let audioProgress = 0;
            let audioDuration = 100; // Simulated duration in seconds
            let currentCharacterSpeaking = null;
            let generatedAudio = null;
            
            // Add sample characters
            addSampleCharacters();
            
            // Initialize waveform
            initWaveform();
            
            // Add character button event
            addCharacterBtn.addEventListener('click', () => {
                currentCharacterId = null;
                modalTitle.textContent = 'Add New Character';
                characterNameInput.value = '';
                voiceDescriptionInput.value = '';
                tagsContainer.innerHTML = '';
                characterModal.style.display = 'flex';
            });
            
            // Close modal events
            closeModal.addEventListener('click', closeCharacterModal);
            cancelBtn.addEventListener('click', closeCharacterModal);
            
            // Add tag event
            addTagBtn.addEventListener('click', addTag);
            tagInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addTag();
                    e.preventDefault();
                }
            });
            
            // Save character event
            saveCharacterBtn.addEventListener('click', saveCharacter);
            
            // Voice examples
            const exampleItems = document.querySelectorAll('.example-item');
            exampleItems.forEach(item => {
                item.addEventListener('click', () => {
                    voiceDescriptionInput.value = item.getAttribute('data-desc');
                });
            });
            
            // Initialize sliders
            const sliders = document.querySelectorAll('.slider');
            sliders.forEach(slider => {
                const id = slider.id;
                const valueDisplay = document.getElementById(`${id.replace('-slider', '-value')}`);
                
                if (valueDisplay) {
                    if (id === 'volume-slider' || id === 'music-volume-slider') {
                        valueDisplay.textContent = `${slider.value}%`;
                    } else {
                        valueDisplay.textContent = slider.value;
                    }
                }
                
                slider.addEventListener('input', () => {
                    if (valueDisplay) {
                        if (id === 'volume-slider' || id === 'music-volume-slider') {
                            valueDisplay.textContent = `${slider.value}%`;
                        } else {
                            valueDisplay.textContent = slider.value;
                        }
                    }
                });
            });
            
            // Volume control
            volumeSlider.addEventListener('input', () => {
                volumeValue.textContent = `${volumeSlider.value}%`;
            });
            
            musicVolumeSlider.addEventListener('input', () => {
                musicVolumeValue.textContent = `${musicVolumeSlider.value}%`;
            });
            
            // Simulate audio playback
            playBtn.addEventListener('click', playAudio);
            
            pauseBtn.addEventListener('click', () => {
                clearInterval(progressInterval);
                isPlaying = false;
                playBtn.disabled = false;
                pauseBtn.disabled = true;
                if (currentCharacterSpeaking) {
                    const characterElement = document.querySelector(`.character-item[data-id="${currentCharacterSpeaking}"]`);
                    if (characterElement) {
                        characterElement.classList.remove('speaking');
                    }
                }
                currentSpeaker.style.display = 'none';
            });
            
            stopBtn.addEventListener('click', () => {
                clearInterval(progressInterval);
                isPlaying = false;
                audioProgress = 0;
                progressSlider.value = 0;
                updateTimeDisplay(0, audioDuration);
                playBtn.disabled = false;
                pauseBtn.disabled = true;
                stopBtn.disabled = true;
                if (currentCharacterSpeaking) {
                    const characterElement = document.querySelector(`.character-item[data-id="${currentCharacterSpeaking}"]`);
                    if (characterElement) {
                        characterElement.classList.remove('speaking');
                    }
                }
                currentSpeaker.style.display = 'none';
                resetWaveform();
            });
            
            progressSlider.addEventListener('input', () => {
                if (!isPlaying) {
                    audioProgress = progressSlider.value;
                    updateTimeDisplay(audioProgress, audioDuration);
                }
            });
            
            // Generate button functionality
            const generateBtn = document.getElementById('generate-btn');
            const loadingIndicator = document.getElementById('loading-indicator');
            
            generateBtn.addEventListener('click', () => {
                if (characters.length === 0) {
                    showNotification('Please add at least one character before generating.');
                    return;
                }
                
                // Check if script contains character markers
                const script = scriptEditor.value;
                const characterMarkers = script.match(/\[(.*?)\]/g);
                
                if (!characterMarkers || characterMarkers.length === 0) {
                    showNotification('Please add character markers to your script (e.g., [CHARACTER:Name]).');
                    return;
                }
                
                // Show loading indicator
                loadingIndicator.style.display = 'block';
                generateBtn.disabled = true;
                
                // Call the backend API
                generatePodcast(script, characters)
                    .then(audioData => {
                        generatedAudio = audioData;
                        
                        // Hide loading indicator
                        loadingIndicator.style.display = 'none';
                        generateBtn.disabled = false;
                        
                        // Enable playback controls
                        playBtn.disabled = false;
                        progressSlider.disabled = false;
                        downloadBtn.disabled = false;
                        
                        // Show success message
                        showNotification('Podcast generated successfully with multiple characters! Click the play button to listen.');
                    })
                    .catch(error => {
                        loadingIndicator.style.display = 'none';
                        generateBtn.disabled = false;
                        showNotification('Error generating podcast: ' + error);
                    });
            });
            
            // Download button functionality
            downloadBtn.addEventListener('click', () => {
                if (!generatedAudio) {
                    showNotification('Please generate a podcast first.');
                    return;
                }
                
                // Download the podcast
                downloadPodcast(generatedAudio);
            });
            
            // Functions for character management
            function addSampleCharacters() {
                const sampleCharacters = [
                    { id: 1, name: 'HOST', description: 'A warm, friendly American Midwest accent that\'s welcoming and approachable', tags: ['american', 'midwest', 'friendly'] },
                    { id: 2, name: 'EXPERT', description: 'A sophisticated British accent with academic undertones', tags: ['british', 'academic', 'sophisticated'] },
                    { id: 3, name: 'TECH', description: 'A heavy Mexican Chino accent that\'s computer savvy and street smart', tags: ['mexican', 'chino', 'tech', 'street-smart'] }
                ];
                
                sampleCharacters.forEach(char => {
                    characters.push(char);
                    renderCharacter(char);
                });
            }
            
            function renderCharacter(character) {
                const characterElement = document.createElement('div');
                characterElement.className = 'character-item';
                characterElement.dataset.id = character.id;
                
                characterElement.innerHTML = `
                    <div class="character-header">
                        <div class="character-name">${character.name}</div>
                        <div class="character-actions">
                            <button class="character-btn edit-btn">Edit</button>
                            <button class="character-btn delete-btn delete">Delete</button>
                        </div>
                    </div>
                    <div class="character-description">${character.description}</div>
                    <div class="tags-container">
                        ${character.tags.map(tag => `<div class="tag">${tag} <button class="tag-remove" data-tag="${tag}">&times;</button></div>`).join('')}
                    </div>
                `;
                
                charactersList.appendChild(characterElement);
                
                // Add event listeners for edit and delete
                characterElement.querySelector('.edit-btn').addEventListener('click', () => {
                    editCharacter(character.id);
                });
                
                characterElement.querySelector('.delete-btn').addEventListener('click', () => {
                    deleteCharacter(character.id);
                });
                
                // Add event listeners for tag removal
                const tagRemoveButtons = characterElement.querySelectorAll('.tag-remove');
                tagRemoveButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const tagToRemove = btn.getAttribute('data-tag');
                        removeTagFromCharacter(character.id, tagToRemove);
                    });
                });
            }
            
            function editCharacter(id) {
                const character = characters.find(c => c.id === id);
                if (character) {
                    currentCharacterId = id;
                    modalTitle.textContent = 'Edit Character';
                    characterNameInput.value = character.name;
                    voiceDescriptionInput.value = character.description;
                    
                    // Clear and repopulate tags
                    tagsContainer.innerHTML = '';
                    character.tags.forEach(tag => {
                        const tagElement = document.createElement('div');
                        tagElement.className = 'tag';
                        tagElement.innerHTML = `
                            ${tag} <button class="tag-remove" data-tag="${tag}">&times;</button>
                        `;
                        tagsContainer.appendChild(tagElement);
                        
                        // Add event listener for tag removal
                        tagElement.querySelector('.tag-remove').addEventListener('click', (e) => {
                            e.stopPropagation();
                            removeTagFromEdit(tag);
                        });
                    });
                    
                    characterModal.style.display = 'flex';
                }
            }
            
            function deleteCharacter(id) {
                if (confirm('Are you sure you want to delete this character?')) {
                    const index = characters.findIndex(c => c.id === id);
                    if (index !== -1) {
                        characters.splice(index, 1);
                        const characterElement = document.querySelector(`.character-item[data-id="${id}"]`);
                        if (characterElement) {
                            characterElement.remove();
                        }
                    }
                }
            }
            
            function addTag() {
                const tag = tagInput.value.trim();
                if (tag && !Array.from(tagsContainer.children).some(el => el.textContent.includes(tag))) {
                    const tagElement = document.createElement('div');
                    tagElement.className = 'tag';
                    tagElement.innerHTML = `
                        ${tag} <button class="tag-remove" data-tag="${tag}">&times;</button>
                    `;
                    tagsContainer.appendChild(tagElement);
                    tagInput.value = '';
                    
                    // Add event listener for tag removal
                    tagElement.querySelector('.tag-remove').addEventListener('click', (e) => {
                        e.stopPropagation();
                        tagElement.remove();
                    });
                }
            }
            
            function removeTagFromEdit(tag) {
                const tagElement = Array.from(tagsContainer.children).find(el => el.textContent.includes(tag));
                if (tagElement) {
                    tagElement.remove();
                }
            }
            
            function removeTagFromCharacter(characterId, tag) {
                const character = characters.find(c => c.id === characterId);
                if (character) {
                    character.tags = character.tags.filter(t => t !== tag);
                    
                    // Re-render the character
                    const characterElement = document.querySelector(`.character-item[data-id="${characterId}"]`);
                    if (characterElement) {
                        characterElement.querySelector('.tags-container').innerHTML = 
                            character.tags.map(tag => `<div class="tag">${tag} <button class="tag-remove" data-tag="${tag}">&times;</button></div>`).join('');
                        
                        // Re-add event listeners for tag removal
                        const tagRemoveButtons = characterElement.querySelectorAll('.tag-remove');
                        tagRemoveButtons.forEach(btn => {
                            btn.addEventListener('click', (e) => {
                                e.stopPropagation();
                                const tagToRemove = btn.getAttribute('data-tag');
                                removeTagFromCharacter(characterId, tagToRemove);
                            });
                        });
                    }
                }
            }
            
            function saveCharacter() {
                const name = characterNameInput.value.trim();
                const description = voiceDescriptionInput.value.trim();
                const tags = Array.from(tagsContainer.children).map(el => el.textContent.replace('×', '').trim());
                
                if (!name || !description) {
                    showNotification('Please provide a name and voice description for the character.');
                    return;
                }
                
                if (currentCharacterId) {
                    // Update existing character
                    const character = characters.find(c => c.id === currentCharacterId);
                    if (character) {
                        character.name = name;
                        character.description = description;
                        character.tags = tags;
                        
                        // Update the character in the UI
                        const characterElement = document.querySelector(`.character-item[data-id="${currentCharacterId}"]`);
                        if (characterElement) {
                            characterElement.querySelector('.character-name').textContent = name;
                            characterElement.querySelector('.character-description').textContent = description;
                            characterElement.querySelector('.tags-container').innerHTML = 
                                tags.map(tag => `<div class="tag">${tag} <button class="tag-remove" data-tag="${tag}">&times;</button></div>`).join('');
                            
                            // Re-add event listeners for tag removal
                            const tagRemoveButtons = characterElement.querySelectorAll('.tag-remove');
                            tagRemoveButtons.forEach(btn => {
                                btn.addEventListener('click', (e) => {
                                    e.stopPropagation();
                                    const tagToRemove = btn.getAttribute('data-tag');
                                    removeTagFromCharacter(currentCharacterId, tagToRemove);
                                });
                            });
                        }
                    }
                } else {
                    // Create new character
                    const newCharacter = {
                        id: Date.now(),
                        name,
                        description,
                        tags
                    };
                    
                    characters.push(newCharacter);
                    renderCharacter(newCharacter);
                }
                
                closeCharacterModal();
            }
            
            function closeCharacterModal() {
                characterModal.style.display = 'none';
            }
            
            function initWaveform() {
                waveBars.innerHTML = '';
                for (let i = 0; i < 100; i++) {
                    const bar = document.createElement('div');
                    bar.className = 'wave-bar';
                    bar.style.height = '2%';
                    waveBars.appendChild(bar);
                }
            }
            
            function resetWaveform() {
                const bars = waveBars.querySelectorAll('.wave-bar');
                bars.forEach(bar => {
                    bar.style.height = '2%';
                });
            }
            
            function animateWaveform() {
                const bars = waveBars.querySelectorAll('.wave-bar');
                bars.forEach(bar => {
                    // Random height but based on progress to make it more natural
                    const baseHeight = 2 + Math.sin(Date.now() / 1000 + parseInt(bar.style.left)) * 10 + Math.random() * 30;
                    bar.style.height = `${Math.max(2, baseHeight)}%`;
                });
            }
            
            function updateTimeDisplay(progress, duration) {
                const progressMinutes = Math.floor(progress / 60);
                const progressSeconds = Math.floor(progress % 60);
                const durationMinutes = Math.floor(duration / 60);
                const durationSeconds = Math.floor(duration % 60);
                
                timeDisplay.textContent = `${progressMinutes}:${progressSeconds.toString().padStart(2, '0')} / ${durationMinutes}:${durationSeconds.toString().padStart(2, '0')}`;
            }
            
            function playAudio() {
                if (isPlaying) return;
                
                isPlaying = true;
                playBtn.disabled = true;
                pauseBtn.disabled = false;
                stopBtn.disabled = false;
                
                // Parse script to find character dialogues
                const script = scriptEditor.value;
                const lines = script.split('\n');
                let dialogueIndex = 0;
                const dialogues = [];
                let currentCharacter = null;
                let currentText = [];
                
                for (const line of lines) {
                    const characterMatch = line.match(/^\[(.*?)\]/);
                    if (characterMatch) {
                        if (currentCharacter) {
                            dialogues.push({
                                character: currentCharacter,
                                text: currentText.join(' ')
                            });
                        }
                        currentCharacter = characterMatch[1];
                        currentText = [];
                    } else if (line.trim() !== '' && currentCharacter) {
                        currentText.push(line.trim());
                    }
                }
                
                if (currentCharacter && currentText.length > 0) {
                    dialogues.push({
                        character: currentCharacter,
                        text: currentText.join(' ')
                    });
                }
                
                // Simulate playback with character highlighting
                let currentDialogue = 0;
                
                progressInterval = setInterval(() => {
                    audioProgress += 0.1;
                    if (audioProgress >= audioDuration) {
                        audioProgress = audioDuration;
                        clearInterval(progressInterval);
                        isPlaying = false;
                        playBtn.disabled = false;
                        pauseBtn.disabled = true;
                        stopBtn.disabled = true;
                        if (currentCharacterSpeaking) {
                            const characterElement = document.querySelector(`.character-item[data-id="${currentCharacterSpeaking}"]`);
                            if (characterElement) {
                                characterElement.classList.remove('speaking');
                            }
                        }
                        currentSpeaker.style.display = 'none';
                    }
                    
                    progressSlider.value = (audioProgress / audioDuration) * 100;
                    updateTimeDisplay(audioProgress, audioDuration);
                    
                    // Animate waveform
                    animateWaveform();
                    
                    // Update current speaker based on progress
                    const progressPercent = audioProgress / audioDuration;
                    const dialogueChangeIndex = Math.floor(progressPercent * dialogues.length);
                    
                    if (dialogueChangeIndex !== currentDialogue && dialogueChangeIndex < dialogues.length) {
                        currentDialogue = dialogueChangeIndex;
                        const dialogue = dialogues[currentDialogue];
                        
                        // Find character ID by name
                        const character = characters.find(c => c.name === dialogue.character);
                        if (character) {
                            // Remove speaking class from all characters
                            document.querySelectorAll('.character-item').forEach(el => {
                                el.classList.remove('speaking');
                            });
                            
                            // Add speaking class to current character
                            const characterElement = document.querySelector(`.character-item[data-id="${character.id}"]`);
                            if (characterElement) {
                                characterElement.classList.add('speaking');
                                currentCharacterSpeaking = character.id;
                                speakerName.textContent = character.name;
                                currentSpeaker.style.display = 'block';
                            }
                        }
                    }
                }, 100);
            }
            
            function showNotification(message) {
                notificationText.textContent = message;
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
            
            // API call to generate podcast
            async function generatePodcast(script, characters) {
                try {
                    const musicStyle = document.getElementById('music-style').value;
                    const musicVolume = document.getElementById('music-volume-slider').value;
                    
                    const response = await fetch('/api/generate-podcast', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            script,
                            characters,
                            musicStyle,
                            musicVolume
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to generate podcast');
                    }
                    
                    const data = await response.json();
                    return data;
                } catch (error) {
                    console.error('Error generating podcast:', error);
                    throw error;
                }
            }
            
            // Download podcast
            function downloadPodcast(audioData) {
                showNotification(`Downloading podcast (${audioData.size})...`);
                
                // Create a temporary link element
                const link = document.createElement('a');
                link.href = audioData.audioUrl;
                link.download = 'podcast.mp3';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Simulate download completion
                setTimeout(() => {
                    showNotification('Podcast downloaded successfully!');
                }, 2000);
            }
        });
    </script>
</body>
</html>